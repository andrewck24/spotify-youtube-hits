# Feature Specification: 技術棧現代化重構

**Feature Branch**: `001-1-typescript-tailwindcss`
**Created**: 2025-10-08
**Status**: Draft
**Input**: User description: "使用以下原則重構這個專案

1. 使用 typescript, tailwindcss, redux/toolkit 重構
2. 元件與線圖使用 shadcn/ui
3. 使用 tailwind css mobile first 方式進行 RWD 設計
4. 使用 fuse.js 進行 client side 搜尋
5. 以 json 重構 data source
   "

## User Scenarios & Testing _(mandatory)_

### User Story 1 - 藝人搜尋與歌曲瀏覽 (Priority: P1)

使用者開啟應用程式後，可以在搜尋列輸入藝人名稱（支援部分關鍵字匹配），系統即時顯示搜尋結果。點擊藝人後，左側顯示藝人資訊（頭像、追蹤數、人氣度），下方列出該藝人的熱門歌曲清單。使用者點擊任一歌曲，右側展示該歌曲的詳細資訊與視覺化圖表。

**Why this priority**: 這是應用程式的核心功能，涵蓋主要使用者流程（搜尋 → 選擇藝人 → 查看歌曲），是最小可行產品（MVP）的基礎。

**Independent Test**: 使用者可以在手機或桌面瀏覽器開啟應用，輸入 "Gorillaz" 搜尋藝人，點擊結果查看藝人資料與歌曲清單，點擊 "Feel Good Inc." 查看歌曲詳細資訊和圖表，整個流程應在 30 秒內完成且介面響應流暢。

**Acceptance Scenarios**:

1. **Given** 使用者開啟應用程式首頁，**When** 在搜尋列輸入 "gor"，**Then** 搜尋結果即時顯示包含 "Gorillaz" 的藝人清單（不超過 12 筆）
2. **Given** 搜尋結果顯示多位藝人，**When** 使用者點擊 "Gorillaz"，**Then** 左側顯示藝人頭像、追蹤人數、人氣指標，下方顯示該藝人熱門歌曲清單
3. **Given** 藝人歌曲清單已顯示，**When** 使用者點擊清單中的第一首歌曲，**Then** 右側顯示歌曲封面、專輯資訊、發行年份、時長，以及人氣圖表與音樂特徵圖表
4. **Given** 使用者在手機瀏覽器（寬度 < 768px）開啟應用，**When** 搜尋並點擊藝人，**Then** 介面自動調整為單欄布局，搜尋列、藝人資訊、歌曲清單垂直排列，操作順暢無橫向滾動

---

### User Story 2 - 離線資料緩存與快速載入 (Priority: P2)

使用者首次開啟應用時，系統自動下載完整歌曲資料庫（JSON 格式，約 5.5MB），並存入瀏覽器本地儲存（sessionStorage 或 IndexedDB）。後續操作（搜尋、切換藝人、查看歌曲）直接從本地資料查詢，無需重複下載，提升載入速度與離線可用性。

**Why this priority**: 提升使用者體驗，減少網路請求，支援弱網或離線環境。屬於效能優化，非核心功能，但對使用者體驗有顯著改善。

**Independent Test**: 使用者首次開啟應用後關閉網路連線，仍可正常搜尋藝人、切換歌曲，驗證資料已緩存至本地。重新整理頁面後，系統不重新下載資料（可透過瀏覽器開發者工具 Network 面板驗證）。

**Acceptance Scenarios**:

1. **Given** 使用者首次開啟應用，**When** 應用載入完成，**Then** 瀏覽器下載 `data/tracks.json` 檔案（約 5.5MB），並顯示載入進度指示器
2. **Given** 資料下載完成，**When** 使用者進行搜尋或切換歌曲，**Then** 操作即時完成（延遲 < 100ms），無網路請求
3. **Given** 資料已緩存至 sessionStorage，**When** 使用者重新整理頁面，**Then** 系統優先從本地載入資料，不重複下載（除非資料版本過期）
4. **Given** 使用者關閉網路連線，**When** 搜尋藝人或查看歌曲，**Then** 應用仍正常運作（僅 Spotify API 即時資料無法更新，如藝人頭像）

---

### User Story 3 - 響應式設計與多裝置支援 (Priority: P3)

應用介面採用 Mobile First 設計原則，在不同螢幕尺寸（手機、平板、桌面）下自動調整布局。手機裝置顯示單欄布局（搜尋 → 藝人資訊 → 歌曲清單 → 歌曲詳情垂直排列），桌面裝置顯示雙欄布局（左側藝人與歌曲清單、右側歌曲詳情並排）。

**Why this priority**: 擴大使用者覆蓋範圍，支援行動裝置使用者。屬於體驗優化，優先級較低，但符合現代 Web 應用標準。

**Independent Test**: 使用瀏覽器開發者工具模擬不同裝置尺寸（iPhone SE 375px、iPad 768px、Desktop 1440px），驗證布局自動調整、文字可讀、圖表正常顯示、無橫向滾動條。

**Acceptance Scenarios**:

1. **Given** 使用者在手機（寬度 < 768px）開啟應用，**When** 查看頁面，**Then** 搜尋列、藝人資訊、歌曲清單、歌曲詳情垂直排列，無橫向滾動，圖表自動縮放
2. **Given** 使用者在平板（寬度 768px - 1024px）開啟應用，**When** 查看頁面，**Then** 左側藝人資訊與歌曲清單（寬度 40%），右側歌曲詳情（寬度 60%），雙欄並排顯示
3. **Given** 使用者在桌面（寬度 > 1024px）開啟應用，**When** 查看頁面，**Then** 左側欄位固定寬度（最大 24rem），右側欄位自適應剩餘空間，圖表放大顯示更多細節
4. **Given** 使用者旋轉裝置（橫向 ↔ 直向），**When** 螢幕方向改變，**Then** 布局即時調整，無需重新整理頁面

---

### Edge Cases

- **搜尋無結果**：當使用者輸入不存在的藝人名稱（如 "xyz123"），顯示「查無相關藝人」提示訊息，而非空白頁面
- **網路中斷**：首次載入時若網路中斷導致資料下載失敗，顯示錯誤訊息與重試按鈕；若資料已緩存，離線時僅禁用需即時資料的功能（如 Spotify API 呼叫）
- **資料過期**：本地緩存資料版本與伺服器不一致時，提示使用者「資料已更新，是否重新載入？」
- **超大螢幕**：在 4K 或超寬螢幕（> 2560px）下，限制內容最大寬度（如 1920px），避免過度拉伸
- **Spotify API 限流**：當 API 呼叫達到速率限制時，顯示友善錯誤訊息「伺服器忙碌中，請稍後再試」，而非技術性錯誤碼
- **舊瀏覽器**：若瀏覽器不支援 sessionStorage 或 IndexedDB，降級為純記憶體緩存（重新整理後需重新下載）

## Requirements _(mandatory)_

### Functional Requirements

- **FR-001**: 系統必須提供藝人搜尋功能，支援部分關鍵字匹配（不區分大小寫），搜尋結果即時顯示，最多顯示 12 筆結果
- **FR-002**: 系統必須在使用者點擊藝人後，顯示藝人資訊（名稱、頭像、追蹤人數、人氣指標）與該藝人的熱門歌曲清單
- **FR-003**: 系統必須在使用者點擊歌曲後，顯示歌曲詳細資訊（名稱、封面、專輯、發行年份、時長）、人氣數據圖表（Spotify 播放數、YouTube 觀看數/按讚數/留言數）、音樂特徵圖表（acousticness、danceability、energy 等）
- **FR-004**: 系統必須在首次載入時下載完整資料庫（靜態 JSON 檔案），並存入瀏覽器本地儲存（sessionStorage 優先，若容量不足則使用記憶體）
- **FR-005**: 系統必須在資料下載期間顯示載入進度指示器（進度條或載入動畫），完成後自動進入搜尋介面
- **FR-006**: 系統必須使用客戶端搜尋引擎（Fuse.js 或 FlexSearch）實現模糊搜尋，支援藝人名稱首字母或部分關鍵字匹配
- **FR-007**: 系統必須採用 Mobile First 響應式設計，在手機裝置（< 768px）顯示單欄布局，桌面裝置（≥ 768px）顯示雙欄布局
- **FR-008**: 系統必須在所有主流瀏覽器（Chrome、Firefox、Safari、Edge 最新兩個版本）正常運作，支援觸控與鍵盤操作
- **FR-009**: 系統必須處理錯誤情境（網路中斷、資料載入失敗、API 限流），顯示使用者友善的錯誤訊息與重試選項
- **FR-010**: 系統必須保持與 Spotify API 的整合，透過 Client Credentials Flow 獲取 access token，查詢藝人資訊、歌曲詳情、音樂特徵
- **FR-011**: 系統必須包含單元測試，覆蓋核心業務邏輯（services、reducers、selectors、utilities），測試覆蓋率達 80% 以上
- **FR-012**: 系統必須包含整合測試，驗證 Spotify API 整合、資料載入流程、搜尋引擎功能正常運作
- **FR-013**: 系統必須包含端對端（E2E）測試，驗證主要使用者流程（搜尋藝人 → 查看歌曲 → 檢視圖表）

### Key Entities

- **Track（歌曲）**：包含歌曲名稱、Spotify ID、藝人資訊、發行年份、人氣指標（Spotify 播放數、YouTube 觀看數/按讚數/留言數）、音樂特徵（acousticness、danceability、energy、valence 等 12 項指標）
- **Artist（藝人）**：包含藝人名稱、Spotify ID、頭像 URL、追蹤人數、人氣指標、關聯歌曲清單
- **SearchIndex（搜尋索引）**：由客戶端搜尋引擎建立的索引結構，支援藝人名稱模糊搜尋，包含藝人名稱、ID、首字母等關鍵欄位

## Success Criteria _(mandatory)_

### Measurable Outcomes

- **SC-001**: 使用者可在 3 秒內完成首次載入（包含下載 5.5MB 資料與建立搜尋索引），後續操作（搜尋、切換歌曲）延遲低於 100ms
- **SC-002**: 系統支援至少 2023 年資料庫中的所有藝人與歌曲（根據現有 dbDataState 約數千筆資料），搜尋結果準確率達 95% 以上（藝人名稱部分匹配）
- **SC-003**: 應用在手機裝置（375px 寬度）、平板（768px）、桌面（1440px）三種螢幕尺寸下，頁面布局正確、文字可讀（字體大小 ≥ 14px）、圖表完整顯示
- **SC-004**: 離線模式下（首次載入後斷網），使用者仍可完成 80% 的核心功能（搜尋、查看歌曲、瀏覽圖表），僅即時資料（藝人頭像、最新人氣指標）無法更新
- **SC-005**: 重構後的應用程式碼品質提升，TypeScript 型別覆蓋率達 90% 以上，ESLint 無錯誤，建置時間縮短 20%（相比現有 Vite + JavaScript）
- **SC-006**: 使用者在桌面與手機裝置的任務完成率達 90% 以上（任務定義：搜尋藝人 → 查看歌曲清單 → 檢視歌曲詳情與圖表）
- **SC-007**: 單元測試覆蓋率達 80% 以上，所有核心模組（services、reducers、selectors、utilities）均有對應測試
- **SC-008**: 整合測試覆蓋所有主要資料流程（資料載入、API 呼叫、搜尋引擎），E2E 測試覆蓋 3 個主要使用者故事

## Assumptions

- 資料庫內容為 2023 年靜態資料，無即時更新需求（若需更新，手動替換 JSON 檔案後重新部署）
- Spotify API 金鑰（Client ID / Secret）已配置在環境變數，不過期或需定期更新
- 使用者瀏覽器支援 ES6+ 語法與現代 Web API（sessionStorage、fetch），不需支援 IE11
- 應用部署於靜態主機（GitHub Pages、Vercel、Netlify），無後端伺服器，所有運算在客戶端執行
- 資料庫 JSON 檔案大小控制在 10MB 以內（目前 5.5MB），超過此大小需考慮分割檔案或改用資料庫方案
- 使用者網路環境至少為 3G（下載 5.5MB 資料約需 10-15 秒），若網路極慢，提供降級方案（分批載入或提示）

## Out of Scope

以下功能不在本次重構範圍內：

- **即時資料更新**：不實作資料自動同步或定期更新機制，資料更新需手動部署
- **使用者帳號系統**：不實作登入、註冊、個人化設定等功能
- **社群互動**：不支援評論、收藏、分享至社群媒體等功能
- **多語言支援**：介面僅提供繁體中文，不實作國際化（i18n）
- **進階篩選與排序**：不實作依年份、人氣、音樂特徵等條件篩選歌曲
- **音樂播放**：不整合 Spotify 或 YouTube 播放器，僅顯示資料與圖表
- **後端 API 開發**：不建立自有後端伺服器或資料庫，保持靜態部署架構
